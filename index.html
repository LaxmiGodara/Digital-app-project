<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory & Finance Management</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    .active-btn { background-color: #2563EB; color: #fff; }
    .btn-edit { background-color: #FBBF24; }
    .btn-delete { background-color: #EF4444; }
    label.required::after {
      content: " *";
      color: red;
      font-weight: bold;
      margin-left: 2px;
    }
    table th:first-child, table td:first-child {
      width: 8%;
      text-align: center;
    }
    table th:nth-child(2), table td:nth-child(2) {
      width: 30%;
    }
    table th:last-child, table td:last-child {
      width: 15%;
      white-space: nowrap;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="flex min-h-screen">
    <aside class="w-64 bg-blue-900 text-white p-5">
      <h1 class="text-2xl font-bold mb-6">Inventory Admin</h1>
      <nav class="space-y-2">
        <button id="dashboard-btn" class="sidebar-btn block w-full text-left px-3 py-2 rounded hover:bg-blue-700">Dashboard</button>
        <button id="purchase-btn" class="sidebar-btn block w-full text-left px-3 py-2 rounded hover:bg-blue-700">Purchase / GRN</button>
        <button id="invoice-btn" class="sidebar-btn block w-full text-left px-3 py-2 rounded hover:bg-blue-700">Invoice Entry</button>
        <button id="customers-btn" class="sidebar-btn block w-full text-left px-3 py-2 rounded hover:bg-blue-700">Customer Management</button>
      </nav>
    </aside>

    <main class="flex-1 p-6 bg-gray-50">
      <!-- Dashboard -->
      <section id="dashboard" class="section">
        <h2 class="text-2xl font-semibold text-blue-800 mb-4">Dashboard</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-white p-4 rounded shadow">
            <p class="text-sm text-gray-600">Customers</p>
            <h3 id="cnt-customers" class="text-xl font-bold">0</h3>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <p class="text-sm text-gray-600">Purchase Orders</p>
            <h3 id="cnt-purchase" class="text-xl font-bold">0</h3>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <p class="text-sm text-gray-600">Invoices</p>
            <h3 id="cnt-invoice" class="text-xl font-bold">0</h3>
          </div>
        </div>
      </section>

      <!-- Purchase / GRN -->
      <section id="purchase" class="section hidden">
        <h2 class="text-2xl font-semibold text-blue-800 mb-4">Purchase / GRN Entry</h2>
        <form id="form-purchase" class="space-y-4 max-w-3xl">
          <label for="purchase-vendor" class="required block">Vendor Name</label>
          <input type="text" id="purchase-vendor" placeholder="Vendor Name" class="w-full p-2 border rounded" required />
          
          <label for="purchase-product" class="required block">Product</label>
          <input type="text" id="purchase-product" placeholder="Product (e.g., Urea 50kg)" class="w-full p-2 border rounded" required />
          
          <label for="purchase-qty" class="required block">Quantity</label>
          <input type="number" id="purchase-qty" placeholder="Quantity" class="w-full p-2 border rounded" required min="1" />
          
          <label for="purchase-rate" class="required block">Rate per Unit</label>
          <input type="number" id="purchase-rate" placeholder="Rate per Unit" class="w-full p-2 border rounded" required min="0" step="0.01" />
          
          <label for="purchase-date" class="required block">Date</label>
          <input type="date" id="purchase-date" class="w-full p-2 border rounded" required />
          
          <label for="purchase-remarks" class="block">Remarks (optional)</label>
          <input type="text" id="purchase-remarks" placeholder="Remarks (optional)" class="w-full p-2 border rounded" />
          
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Submit Purchase</button>
        </form>

        <table class="min-w-full bg-white mt-6 border text-sm">
          <thead class="bg-gray-200"><tr>
            <th class="p-2 border">#</th>
            <th class="p-2 border">Vendor</th>
            <th class="p-2 border">Product</th>
            <th class="p-2 border">Quantity</th>
            <th class="p-2 border">Rate</th>
            <th class="p-2 border">Date</th>
            <th class="p-2 border">Remarks</th>
            <th class="p-2 border">Actions</th>
          </tr></thead>
          <tbody id="tbl-purchase"></tbody>
        </table>
      </section>

      <!-- Invoice Entry -->
      <section id="invoice" class="section hidden">
        <h2 class="text-2xl font-semibold text-blue-800 mb-4">Invoice Entry</h2>
        <form id="form-invoice" class="space-y-4 max-w-3xl">
          <label for="invoice-customer" class="required block">Customer</label>
          <select id="invoice-customer" class="w-full p-2 border rounded" required>
            <option value="">Select Customer</option>
          </select>
          
          <label for="invoice-date" class="required block">Date</label>
          <input type="date" id="invoice-date" class="w-full p-2 border rounded" required />
          
          <label for="invoice-product" class="required block">Product</label>
          <input type="text" id="invoice-product" placeholder="Product (e.g., Urea 50kg)" class="w-full p-2 border rounded" required />
          
          <label for="invoice-qty" class="required block">Quantity</label>
          <input type="number" id="invoice-qty" placeholder="Quantity" class="w-full p-2 border rounded" required min="1" />
          
          <label for="invoice-rate" class="required block">Rate per Unit</label>
          <input type="number" id="invoice-rate" placeholder="Rate per Unit" class="w-full p-2 border rounded" required min="0" step="0.01" />
          
          <label for="invoice-gst" class="block">GST %</label>
          <input type="number" id="invoice-gst" placeholder="GST %" class="w-full p-2 border rounded" min="0" max="100" />
          
          <label for="invoice-discount" class="block">Discount</label>
          <input type="number" id="invoice-discount" placeholder="Discount" class="w-full p-2 border rounded" min="0" step="0.01" />
          
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Submit Invoice</button>
        </form>

        <table class="min-w-full bg-white mt-6 border text-sm">
          <thead class="bg-gray-200"><tr>
            <th class="p-2 border">#</th>
            <th class="p-2 border">Customer</th>
            <th class="p-2 border">Date</th>
            <th class="p-2 border">Product</th>
            <th class="p-2 border">Quantity</th>
            <th class="p-2 border">Rate</th>
            <th class="p-2 border">GST %</th>
            <th class="p-2 border">Discount</th>
            <th class="p-2 border">Actions</th>
          </tr></thead>
          <tbody id="tbl-invoice"></tbody>
        </table>
      </section>

      <!-- Customer Management -->
      <section id="customers" class="section hidden">
        <h2 class="text-2xl font-semibold text-blue-800 mb-4">Customer Management</h2>
        <form id="form-customers" class="space-y-4 max-w-3xl">
          <input type="hidden" id="cust-id" />
          <label for="cust-name" class="required block">Customer Name</label>
          <input type="text" id="cust-name" placeholder="Customer Name" required class="w-full p-2 border rounded" />
          
          <label for="cust-mobile" class="required block">Mobile Number</label>
          <input type="text" id="cust-mobile" placeholder="Mobile Number" required class="w-full p-2 border rounded" />
          
          <label for="cust-address" class="required block">Address (Village/Town/City)</label>
          <input type="text" id="cust-address" placeholder="Address" required class="w-full p-2 border rounded" />
          
          <label for="cust-gst" class="block">GST Number (optional)</label>
          <input type="text" id="cust-gst" placeholder="GST Number" class="w-full p-2 border rounded" />
          
          <label for="cust-credit" class="block">Credit Limit (optional)</label>
          <input type="number" id="cust-credit" placeholder="Credit Limit" class="w-full p-2 border rounded" />
          
          <label for="cust-desc" class="block">Description (optional)</label>
          <input type="text" id="cust-desc" placeholder="Description" class="w-full p-2 border rounded" />
          
          <div class="flex space-x-2">
            <button type="submit" id="btn-save" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add Customer</button>
            <button type="button" id="btn-cancel" class="bg-gray-400 text-white px-4 py-2 rounded hidden">Cancel</button>
          </div>
        </form>

        <table class="min-w-full bg-white mt-6 border text-sm">
          <thead class="bg-gray-200"><tr>
            <th class="p-2 border">#</th>
            <th class="p-2 border">Name</th>
            <th class="p-2 border">Mobile</th>
            <th class="p-2 border">Address</th>
            <th class="p-2 border">GST No</th>
            <th class="p-2 border">Actions</th>
          </tr></thead>
          <tbody id="tbl-customers"></tbody>
        </table>
      </section>
    </main>
  </div>

<script>
  function generateUniqueId() {
    return Date.now().toString(36) + Math.random().toString(36).slice(2);
  }

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
    document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active-btn'));
    document.getElementById(id).classList.remove('hidden');
    document.getElementById(id + '-btn').classList.add('active-btn');
    if (id === 'customers') {
      setTimeout(() => document.getElementById('cust-name').focus(), 100);
      clearCustomerForm();
      renderCustomers();
    } else if (id === 'purchase') {
      clearPurchaseForm();
      renderPurchases();
      setTimeout(() => document.getElementById('purchase-vendor').focus(), 100);
    } else if (id === 'invoice') {
      clearInvoiceForm();
      renderInvoices();
      populateInvoiceCustomers();
      setTimeout(() => document.getElementById('invoice-customer').focus(), 100);
    } else if (id === 'dashboard') {
      // No inputs to focus
    }
  }

  window.onload = () => {
    ['dashboard', 'purchase', 'invoice', 'customers'].forEach(id => {
      document.getElementById(id + '-btn').onclick = () => showSection(id);
    });
    showSection('dashboard');
    updateDashboardCounters();
    setDefaultDates();
  };

  function setDefaultDates() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('purchase-date').value = today;
    document.getElementById('invoice-date').value = today;
  }

  // Customers CRUD and render
  function getCustomers() {
    return JSON.parse(localStorage.getItem('customers') || '[]');
  }
  function setCustomers(arr) {
    localStorage.setItem('customers', JSON.stringify(arr));
  }
  function updateDashboardCounters() {
    document.getElementById('cnt-customers').textContent = getCustomers().length;
    document.getElementById('cnt-purchase').textContent = getPurchases().length;
    document.getElementById('cnt-invoice').textContent = getInvoices().length;
  }
  function renderCustomers() {
    const tbody = document.getElementById('tbl-customers');
    tbody.innerHTML = '';
    getCustomers().forEach((c, i) => {
      const tr = document.createElement('tr');
      const serialTd = document.createElement('td');
      serialTd.className = 'p-2 border text-center';
      serialTd.textContent = i + 1;
      tr.appendChild(serialTd);
      ['name', 'mobile', 'address', 'gst'].forEach(k => {
        const td = document.createElement('td');
        td.className = 'p-2 border';
        td.textContent = c[k] || '';
        tr.appendChild(td);
      });
      const tdActions = document.createElement('td');
      tdActions.className = 'p-2 border flex space-x-2';
      const btnE = document.createElement('button');
      btnE.textContent = 'Edit';
      btnE.className = 'btn-edit text-white px-2 py-1 rounded';
      btnE.onclick = () => editCustomer(c.id);
      const btnD = document.createElement('button');
      btnD.textContent = 'Delete';
      btnD.className = 'btn-delete text-white px-2 py-1 rounded';
      btnD.onclick = () => deleteCustomer(c.id);
      tdActions.append(btnE, btnD);
      tr.appendChild(tdActions);
      tbody.appendChild(tr);
    });
  }
  const formCustomer = document.getElementById('form-customers');
  const btnCancelCustomer = document.getElementById('btn-cancel');

  formCustomer.onsubmit = e => {
    e.preventDefault();
    const id = document.getElementById('cust-id').value;
    const customer = {
      id: id || generateUniqueId(),
      name: document.getElementById('cust-name').value.trim(),
      mobile: document.getElementById('cust-mobile').value.trim(),
      address: document.getElementById('cust-address').value.trim(),
      gst: document.getElementById('cust-gst').value.trim(),
      credit: document.getElementById('cust-credit').value,
      desc: document.getElementById('cust-desc').value.trim()
    };
    let arr = getCustomers();
    const nameExists = arr.some(c => c.name.toLowerCase() === customer.name.toLowerCase() && c.id !== customer.id);
    if (nameExists) {
      if (!confirm(`Warning: The customer name "${customer.name}" already exists. Do you want to proceed?`)) {
        return;
      }
    }
    if (id) {
      arr = arr.map(c => c.id === customer.id ? customer : c);
    } else {
      arr.push(customer);
    }
    setCustomers(arr);
    clearCustomerForm();
    renderCustomers();
    updateDashboardCounters();
    formCustomer.querySelector('#btn-save').textContent = 'Add Customer';
    btnCancelCustomer.classList.add('hidden');
  };

  btnCancelCustomer.onclick = () => {
    clearCustomerForm();
    btnCancelCustomer.classList.add('hidden');
    formCustomer.querySelector('#btn-save').textContent = 'Add Customer';
  };

  function editCustomer(id) {
    const c = getCustomers().find(c => c.id === id);
    if (!c) return;
    document.getElementById('cust-id').value = c.id;
    document.getElementById('cust-name').value = c.name;
    document.getElementById('cust-mobile').value = c.mobile;
    document.getElementById('cust-address').value = c.address;
    document.getElementById('cust-gst').value = c.gst;
    document.getElementById('cust-credit').value = c.credit;
    document.getElementById('cust-desc').value = c.desc;
    formCustomer.querySelector('#btn-save').textContent = 'Update Customer';
    btnCancelCustomer.classList.remove('hidden');
    document.getElementById('cust-name').focus();
  }

  function deleteCustomer(id) {
    const arr = getCustomers().filter(c => c.id !== id);
    setCustomers(arr);
    renderCustomers();
    updateDashboardCounters();
  }

  function clearCustomerForm() {
    document.getElementById('cust-id').value = '';
    formCustomer.reset();
  }

  // Purchases
  function getPurchases() {
    return JSON.parse(localStorage.getItem('purchases') || '[]');
  }
  function setPurchases(arr) {
    localStorage.setItem('purchases', JSON.stringify(arr));
  }
  function renderPurchases() {
    const tbody = document.getElementById('tbl-purchase');
    tbody.innerHTML = '';
    getPurchases().forEach((p, i) => {
      const tr = document.createElement('tr');
      const serialTd = document.createElement('td');
      serialTd.className = 'p-2 border text-center';
      serialTd.textContent = i + 1;
      tr.appendChild(serialTd);
      ['vendor', 'product', 'qty', 'rate', 'date', 'remarks'].forEach(k => {
        const td = document.createElement('td');
        td.className = 'p-2 border';
        td.textContent = p[k] || '';
        tr.appendChild(td);
      });
      const tdActions = document.createElement('td');
      tdActions.className = 'p-2 border flex space-x-2';
      const btnE = document.createElement('button');
      btnE.textContent = 'Edit';
      btnE.className = 'btn-edit text-white px-2 py-1 rounded';
      btnE.onclick = () => editPurchase(p.id);
      const btnD = document.createElement('button');
      btnD.textContent = 'Delete';
      btnD.className = 'btn-delete text-white px-2 py-1 rounded';
      btnD.onclick = () => deletePurchase(p.id);
      tdActions.append(btnE, btnD);
      tr.appendChild(tdActions);
      tbody.appendChild(tr);
    });
  }
  const formPurchase = document.getElementById('form-purchase');

  formPurchase.onsubmit = e => {
    e.preventDefault();
    const id = formPurchase.getAttribute('data-edit-id');
    const purchase = {
      id: id || generateUniqueId(),
      vendor: document.getElementById('purchase-vendor').value.trim(),
      product: document.getElementById('purchase-product').value.trim(),
      qty: document.getElementById('purchase-qty').value,
      rate: document.getElementById('purchase-rate').value,
      date: document.getElementById('purchase-date').value,
      remarks: document.getElementById('purchase-remarks').value.trim()
    };
    let arr = getPurchases();
    if (id) {
      arr = arr.map(p => p.id === purchase.id ? purchase : p);
    } else {
      arr.push(purchase);
    }
    setPurchases(arr);
    clearPurchaseForm();
    renderPurchases();
    updateDashboardCounters();
    formPurchase.removeAttribute('data-edit-id');
  };

  function editPurchase(id) {
    const p = getPurchases().find(p => p.id === id);
    if (!p) return;
    document.getElementById('purchase-vendor').value = p.vendor;
    document.getElementById('purchase-product').value = p.product;
    document.getElementById('purchase-qty').value = p.qty;
    document.getElementById('purchase-rate').value = p.rate;
    document.getElementById('purchase-date').value = p.date;
    document.getElementById('purchase-remarks').value = p.remarks;
    formPurchase.setAttribute('data-edit-id', p.id);
    document.getElementById('purchase-vendor').focus();
  }

  function deletePurchase(id) {
    const arr = getPurchases().filter(p => p.id !== id);
    setPurchases(arr);
    renderPurchases();
    updateDashboardCounters();
  }

  function clearPurchaseForm() {
    formPurchase.reset();
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('purchase-date').value = today;
    formPurchase.removeAttribute('data-edit-id');
  }

  // Invoices
  function getInvoices() {
    return JSON.parse(localStorage.getItem('invoices') || '[]');
  }
  function setInvoices(arr) {
    localStorage.setItem('invoices', JSON.stringify(arr));
  }
  function renderInvoices() {
    const tbody = document.getElementById('tbl-invoice');
    tbody.innerHTML = '';
    getInvoices().forEach((inv, i) => {
      const tr = document.createElement('tr');
      const serialTd = document.createElement('td');
      serialTd.className = 'p-2 border text-center';
      serialTd.textContent = i + 1;
      tr.appendChild(serialTd);
      ['customer', 'date', 'product', 'qty', 'rate', 'gst', 'discount'].forEach(k => {
        const td = document.createElement('td');
        td.className = 'p-2 border';
        td.textContent = inv[k] || '';
        tr.appendChild(td);
      });
      const tdActions = document.createElement('td');
      tdActions.className = 'p-2 border flex space-x-2';
      const btnE = document.createElement('button');
      btnE.textContent = 'Edit';
      btnE.className = 'btn-edit text-white px-2 py-1 rounded';
      btnE.onclick = () => editInvoice(inv.id);
      const btnD = document.createElement('button');
      btnD.textContent = 'Delete';
      btnD.className = 'btn-delete text-white px-2 py-1 rounded';
      btnD.onclick = () => deleteInvoice(inv.id);
      tdActions.append(btnE, btnD);
      tr.appendChild(tdActions);
      tbody.appendChild(tr);
    });
  }
  const formInvoice = document.getElementById('form-invoice');

  formInvoice.onsubmit = e => {
    e.preventDefault();
    const id = formInvoice.getAttribute('data-edit-id');
    const invoice = {
      id: id || generateUniqueId(),
      customer: document.getElementById('invoice-customer').value,
      date: document.getElementById('invoice-date').value,
      product: document.getElementById('invoice-product').value.trim(),
      qty: document.getElementById('invoice-qty').value,
      rate: document.getElementById('invoice-rate').value,
      gst: document.getElementById('invoice-gst').value || 0,
      discount: document.getElementById('invoice-discount').value || 0
    };
    let arr = getInvoices();
    if (id) {
      arr = arr.map(inv => inv.id === invoice.id ? invoice : inv);
    } else {
      arr.push(invoice);
    }
    setInvoices(arr);
    clearInvoiceForm();
    renderInvoices();
    updateDashboardCounters();
    formInvoice.removeAttribute('data-edit-id');
  };

  function editInvoice(id) {
    const inv = getInvoices().find(inv => inv.id === id);
    if (!inv) return;
    document.getElementById('invoice-customer').value = inv.customer;
    document.getElementById('invoice-date').value = inv.date;
    document.getElementById('invoice-product').value = inv.product;
    document.getElementById('invoice-qty').value = inv.qty;
    document.getElementById('invoice-rate').value = inv.rate;
    document.getElementById('invoice-gst').value = inv.gst;
    document.getElementById('invoice-discount').value = inv.discount;
    formInvoice.setAttribute('data-edit-id', inv.id);
    document.getElementById('invoice-customer').focus();
  }

  function deleteInvoice(id) {
    const arr = getInvoices().filter(inv => inv.id !== id);
    setInvoices(arr);
    renderInvoices();
    updateDashboardCounters();
  }

  function clearInvoiceForm() {
    formInvoice.reset();
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('invoice-date').value = today;
    formInvoice.removeAttribute('data-edit-id');
  }

  function populateInvoiceCustomers() {
    const select = document.getElementById('invoice-customer');
    const customers = getCustomers();
    select.innerHTML = '<option value="">Select Customer</option>';
    customers.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c.name;
      opt.textContent = c.name;
      select.appendChild(opt);
    });
  }

  // Auto-focus next input after date change (purchase and invoice)
  document.getElementById('purchase-date').addEventListener('change', () => {
    document.getElementById('purchase-remarks').focus();
  });
  document.getElementById('invoice-date').addEventListener('change', () => {
    document.getElementById('invoice-product').focus();
  });
</script>
</body>
</html>

